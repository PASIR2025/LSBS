<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Industrial ‚Äì Motor y Conductores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <script>
    // Registro del Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrado ‚úÖ'))
        .catch(error => console.log('Service Worker error:', error));
    }

    // Manejo de instalaci√≥n PWA
    let deferredPrompt = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      // Evita que el navegador muestre su banner autom√°tico
      e.preventDefault();
      deferredPrompt = e;

      // Mostrar bot√≥n solo si estamos en m√≥vil
      const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      const installBtn = document.getElementById('installBtn');
      if (isMobile && installBtn) {
        installBtn.style.display = 'inline-block';
      }
    });

    async function instalarApp() {
      if (!deferredPrompt) {
        alert("Si tu navegador lo permite, tambi√©n puedes instalar desde el men√∫ 'A√±adir a pantalla de inicio'.");
        return;
      }

      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log('Resultado de instalaci√≥n:', outcome);

      // Limpiamos y ocultamos el bot√≥n
      deferredPrompt = null;
      const installBtn = document.getElementById('installBtn');
      if (installBtn) installBtn.style.display = 'none';
    }
  </script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    /* üåû Modo Claro base */
    body.light {
      background: radial-gradient(circle at top, #e0f2fe 0, #f9fafb 45%, #e5e7eb 100%);
      color: #0f172a;
    }
    body.light table {
      background-color: #ffffff;
    }

    /* üåô Modo Oscuro base */
    body.dark {
      background-color: #020617;
      color: #f9fafb;
    }
    body.dark table {
      background-color: #111827;
    }

    /* CONTENEDOR TARJETA ‚Äì estilo iOS */
    .contenedor {
      max-width: 480px;
      margin: 24px auto 32px auto;
      padding: 22px 18px 26px 18px;
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow:
        0 18px 55px rgba(15, 23, 42, 0.35),
        0 0 0 1px rgba(15, 23, 42, 0.06);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.08), transparent 55%),
                  radial-gradient(circle at top right, rgba(129, 140, 248, 0.08), transparent 55%),
                  rgba(15, 23, 42, 0.96);
    }

    body.light .contenedor {
      background: #ffffff;
      box-shadow:
        0 22px 55px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(148, 163, 184, 0.3);
      border-color: #e5e7eb;
    }

    /* ‚≠ê BARRA SUPERIOR CON ICONOS CENTRADOS */
    .top-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 6px;
      margin-bottom: 10px;
    }

    .top-social-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .top-actions {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    .top-icon-btn {
      background: transparent;
      border: none;
      padding: 0;
      margin: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .top-icon-img {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      object-fit: cover;
      box-shadow: 0 4px 10px rgba(0,0,0,0.35);
      transition: transform 120ms ease-out, box-shadow 120ms ease-out, filter 120ms ease-out;
    }

    /* YouTube un poco m√°s angosto */
    .icon-youtube-img {
      width: 42px;
      height: 28px;
      border-radius: 8px;
      object-fit: cover;
    }

    .top-icon-btn:hover .top-icon-img {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      filter: brightness(1.07);
    }

    /* HEADER */
    h2 {
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #e5f0ff;
      margin-top: 4px;
      margin-bottom: 10px;
    }
    body.light h2 {
      color: #1d4ed8;
    }

    h2 img {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.35);
      background: #0b1120;
      object-fit: contain;
    }

    .subtitulo {
      margin-top: 3px;
      font-size: 0.82em;
      color: #9ca3af;
    }
    body.light .subtitulo {
      color: #6b7280;
    }

    label, input, select {
      display: block;
      margin-top: 10px;
      width: 100%;
    }

    input, select, button {
      font-size: 0.98em;
    }

    .info-unidad {
      font-size: 0.8em;
      color: #9ca3af;
      margin-top: 2px;
    }
    body.light .info-unidad {
      color: #6b7280;
    }

    /* Inputs estilo iOS */
    input, select {
      margin-top: 6px;
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.85);
      color: inherit;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.45);
    }

    body.light input,
    body.light select {
      background: #f9fafb;
      border-color: #cbd5f5;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.4);
    }

    input::placeholder {
      color: #6b7280;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.45);
    }

    /* Botones generales */
    .botones {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .botones button {
      flex: 1;
      min-width: 145px;
      border-radius: 999px;
      padding: 10px 14px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(30, 64, 175, 0.65);
      transition: transform 140ms ease-out, box-shadow 140ms ease-out, background 140ms ease-out;
    }

    .botones button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 26px rgba(30, 64, 175, 0.8);
      background: linear-gradient(135deg, #1d4ed8, #4338ca);
    }

    .botones button:active {
      transform: translateY(0);
      box-shadow: 0 5px 12px rgba(30, 64, 175, 0.7);
    }

    /* Botones modo e instalar */
    .modo-btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      box-shadow: 0 5px 12px rgba(15, 23, 42, 0.55);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 130ms ease-out, box-shadow 130ms ease-out, background 130ms ease-out;
    }

    .modo-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.75);
      background: #0f172a;
    }

    .modo-btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
    }

    body.light .modo-btn {
      background: #f3f4f6;
      color: #111827;
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.5);
    }

    /* Bot√≥n instalar espec√≠fico */
    #installBtn {
      background: linear-gradient(135deg, #0ea5e9, #2563eb);
      color: #f9fafb;
      box-shadow: 0 7px 16px rgba(37, 99, 235, 0.7);
      display: none; /* visible s√≥lo si el evento beforeinstallprompt lo habilita */
    }

    /* Botones de info dentro del resultado */
    .info-btn {
      margin-right: 8px;
      font-size: 0.85em;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background-color: #020617;
      color: #e5e7eb;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
    }

    body.light .info-btn {
      background-color: #f3f4f6;
      color: #111827;
      border-color: #cbd5e1;
      box-shadow: 0 4px 9px rgba(148, 163, 184, 0.55);
    }

    .info-btn.activo-info {
      background: #22c55e;
      border-color: #16a34a;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.45), 0 6px 16px rgba(22, 163, 74, 0.7);
      transform: translateY(-1px);
    }

    .info-calculo {
      margin-top: 14px;
      font-size: 0.9em;
      line-height: 1.5;
    }
    .info-calculo ul {
      margin-top: 6px;
      padding-left: 20px;
    }

    /* Tabs / Secciones */
    .tabs {
      display: flex;
      gap: 6px;
      margin: 10px 0 14px 0;
      flex-wrap: wrap;
      padding: 3px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      box-shadow: inset 0 0 0 1px rgba(30, 64, 175, 0.45);
    }

    body.light .tabs {
      background: #e5e7eb;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.8);
    }

    .tab-btn {
      flex: 1;
      min-width: 130px;
      padding: 7px 10px;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: #cbd5f5;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      transition: background 140ms ease-out, color 140ms ease-out, transform 120ms ease-out;
    }

    body.light .tab-btn {
      color: #374151;
    }

    .tab-btn.activo {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #f9fafb;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.8);
      transform: translateY(-1px);
      font-weight: 600;
    }

    /* RESULTADOS */
    .resultado {
      margin-top: 20px;
      padding: 16px 14px 18px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at top, rgba(15, 118, 110, 0.16), transparent 55%),
                  rgba(15, 23, 42, 0.96);
      display: none;
      box-shadow: 0 16px 38px rgba(15, 23, 42, 0.9);
      font-size: 0.95em;
    }

    body.light .resultado {
      background: #f9fafb;
      border-color: #bfdbfe;
      box-shadow: 0 16px 38px rgba(15, 23, 42, 0.12);
    }

    .etiqueta-itm {
      font-size: 0.8em;
      margin-top: 4px;
      color: #a5b4fc;
    }
    body.light .etiqueta-itm {
      color: #2563eb;
    }

    .proteccion {
      display: flex;
      align-items: center;
      margin-top: 12px;
      padding: 9px 8px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(30, 64, 175, 0.6);
    }

    body.light .proteccion {
      background: #eff6ff;
      border-color: #bfdbfe;
    }

    .proteccion img {
      width: 56px;
      margin-right: 12px;
      filter: drop-shadow(0 4px 10px rgba(15, 23, 42, 0.6));
    }

    .opcional {
      font-size: 0.8em;
      font-style: italic;
    }

    /* Tabla AWG */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.88em;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid rgba(75, 85, 99, 0.8);
      padding: 6px 4px;
      text-align: center;
    }
    th {
      font-weight: 600;
      background: rgba(15, 23, 42, 0.9);
    }
    body.light th {
      background: #e5f0ff;
      color: #111827;
      border-color: #cbd5e1;
    }
    body.light td {
      border-color: #cbd5e1;
    }

    /* üî∞ Resaltado de secci√≥n recomendada en la lista */
    .recomendado {
      background-color: rgba(34, 197, 94, 0.13);
      border-radius: 4px;
      font-weight: bold;
      padding: 4px 6px;
      border-left: 4px solid #22c55e;
    }

    /* FOOTER ‚Äì enlace elegante a tu p√°gina */
    .footer-app {
      margin-top: 18px;
      text-align: right;
      font-size: 0.86em;
    }

    .footer-app a {
      text-decoration: none;
      color: #93c5fd;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      transition: color 130ms ease-out, background 130ms ease-out, transform 120ms ease-out;
    }

    .footer-app a::after {
      content: "‚Üí";
      font-size: 0.9em;
      margin-top: 1px;
    }

    .footer-app a:hover {
      background: rgba(37, 99, 235, 0.16);
      transform: translateX(1px);
      color: #bfdbfe;
    }

    body.light .footer-app a {
      color: #2563eb;
    }

    body.light .footer-app a:hover {
      background: rgba(37, 99, 235, 0.08);
      color: #1d4ed8;
    }

    @media (max-width: 480px) {
      .contenedor {
        margin: 16px 10px 26px 10px;
        padding: 18px 14px 22px 14px;
      }

      h2 {
        font-size: 1.2em;
      }

      .botones button {
        font-size: 0.92em;
      }
    }
  </style>
</head>
<body class="dark">
  <div class="contenedor">

    <!-- üîù Barra superior con iconos y botones -->
    <div class="top-bar">
      <div class="top-social-links">
        <button class="top-icon-btn"
                onclick="window.open('https://www.tiktok.com/@mecatronica.industrial?_r=1&_t=ZS-91QgIcgp3g1', '_blank')">
          <img src="imagenes/tiktok.png" alt="TikTok" class="top-icon-img">
        </button>

        <button class="top-icon-btn"
                onclick="window.open('https://www.facebook.com/share/17jbzqJP4N/', '_blank')">
          <img src="imagenes/facebook.png" alt="Facebook" class="top-icon-img">
        </button>

        <button class="top-icon-btn"
                onclick="window.open('https://www.youtube.com/@pasir_indrustrial', '_blank')">
          <img src="imagenes/youtube.png" alt="YouTube" class="top-icon-img icon-youtube-img">
        </button>

        <button class="top-icon-btn"
                onclick="window.open('https://pasir.anibalcopitan.com/#', '_blank')">
          <img src="imagenes/manuales.png" alt="Manuales y cursos" class="top-icon-img">
        </button>

        <button class="top-icon-btn"
                onclick="window.open('https://wa.link/ykpmx5', '_blank')">
          <img src="imagenes/whatsapp.png" alt="WhatsApp" class="top-icon-img">
        </button>
      </div>

      <div class="top-actions">
        <button class="modo-btn" onclick="toggleModo()">üåû/üåô Modo</button>
        <button class="modo-btn" id="installBtn" onclick="instalarApp()">üì≤ Instalar app</button>
      </div>
    </div>

    <h2>
      <img src="imagenes/logo.png" alt="Logo">
      <span>
        CALCULADORA INDUSTRIAL<br>
        <span class="subtitulo">Protecciones de motor & calibre de conductor</span>
      </span>
    </h2>

    <!-- Tabs de secciones -->
    <div class="tabs">
      <button id="btnProtecciones" class="tab-btn activo" onclick="mostrarSeccion('protecciones')">
        ‚öô Motor
      </button>
      <button id="btnConductores" class="tab-btn" onclick="mostrarSeccion('conductores')">
        üîå Conductor
      </button>
    </div>

    <!-- SECCI√ìN 1: PROTECCIONES DE MOTOR -->
    <div id="seccionProtecciones">
      <label for="potenciaHp">Potencia del motor (HP):</label>
      <input type="number" id="potenciaHp" step="0.01" placeholder="Ej: 7.5" oninput="hpToKw()">
      <div class="info-unidad">Conversi√≥n autom√°tica a kW.</div>

      <label for="potenciaKw" style="margin-top:20px;">Potencia del motor (kW):</label>
      <input type="number" id="potenciaKw" step="0.01" placeholder="Ej: 5.6" oninput="kwToHp()">
      <div class="info-unidad">Conversi√≥n autom√°tica a HP.</div>

      <label for="voltaje">Tensi√≥n trif√°sica (V):</label>
      <select id="voltaje">
        <option value="220">220 V</option>
        <option value="380" selected>380 V</option>
        <option value="440">440 V</option>
      </select>

      <label for="eficiencia">Eficiencia estimada (Œ∑):</label>
      <input type="number" id="eficiencia" value="0.90" min="0.5" max="1" step="0.01">

      <label for="fp">Factor de potencia (cos œÜ):</label>
      <input type="number" id="fp" value="0.85" min="0.1" max="1" step="0.01">

      <label for="arranque">Tipo de arranque:</label>
      <select id="arranque">
        <option value="1">Directo</option>
        <option value="estrella">Estrella-tri√°ngulo</option>
        <option value="0.7">Arrancador suave</option>
        <option value="vfd">Variador de frecuencia (VFD)</option>
      </select>

      <div class="botones">
        <button onclick="calcularProtecciones()">Calcular</button>
        <button onclick="window.print()">üñ® Imprimir / Guardar PDF</button>
      </div>

      <div id="resultadoProtecciones" class="resultado" style="display:none;"></div>
    </div>

    <!-- SECCI√ìN 2: C√ÅLCULO DE CONDUCTOR -->
    <div id="seccionConductores" style="display:none;">
      <label for="sistemaConductor">Sistema:</label>
      <select id="sistemaConductor">
        <option value="3f" selected>Trif√°sico</option>
        <option value="1f">Monof√°sico</option>
      </select>

      <label for="tipoCarga">Tipo de carga:</label>
      <select id="tipoCarga" onchange="actualizarFactorPorCarga()">
        <option value="motor" selected>Motor trif√°sico</option>
        <option value="iluminacion">Iluminaci√≥n</option>
        <option value="tomas">Tomas / uso general</option>
        <option value="otro">Otra carga / personalizado</option>
      </select>
      <div class="info-unidad">
        Define el uso principal del circuito para sugerir el factor de dise√±o.
      </div>

      <label for="corrienteCond">Corriente nominal del circuito In (A):</label>
      <input type="number" id="corrienteCond" step="0.1" placeholder="Ej: 18.5">
      <div class="info-unidad">
        Ingresa la corriente nominal (por ejemplo, In del motor seg√∫n placa o tabla).
      </div>

      <label for="factorDiseno">Factor de dise√±o (In √ó ‚Ä¶):</label>
      <select id="factorDiseno">
        <option value="1.00">1.00 (sin margen adicional)</option>
        <option value="1.15">1.15 (tomas / uso general)</option>
        <option value="1.20">1.20 (margen t√≠pico de dise√±o)</option>
        <option value="1.25" selected>1.25 (motores ‚Äì criterio tipo NEC 430.22)</option>
      </select>
      <div class="info-unidad">
        El valor puede ajustarse seg√∫n normativa y criterios del dise√±ador.
      </div>

      <label for="voltajeCond" style="margin-top:15px;">Tensi√≥n de servicio (V):</label>
      <select id="voltajeCond">
        <option value="220">220 V</option>
        <option value="380" selected>380 V</option>
        <option value="440">440 V</option>
      </select>

      <label for="longitud">Longitud del circuito (ida) en metros:</label>
      <input type="number" id="longitud" step="1" placeholder="Ej: 35">

      <label for="material">Material del conductor:</label>
      <select id="material">
        <option value="cu" selected>Cobre</option>
        <option value="al">Aluminio</option>
      </select>

      <label for="caidaMax">Ca√≠da de tensi√≥n m√°xima permitida (%):</label>
      <input type="number" id="caidaMax" value="3" min="1" max="10" step="0.1">
      <div class="info-unidad">
        Referencia t√≠pica CNE/IEC: 3% para alimentadores de motor, 5% m√°ximo total.
      </div>

      <div class="botones">
        <button onclick="calcularConductor()">Calcular conductor</button>
        <button onclick="window.print()">üñ® Imprimir / Guardar PDF</button>
      </div>

      <div id="resultadoConductor" class="resultado" style="display:none;"></div>
    </div>

    <!-- Footer con enlace elegante -->
    <div class="footer-app">
      <a href="https://pasir.anibalcopitan.com/#" target="_blank" rel="noopener noreferrer">
        Pasir Industrial
      </a>
    </div>

  </div>

  <script>
    const HP_TO_KW = 0.746;

    function toggleModo() {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    }

    function mostrarSeccion(seccion) {
      const secProt = document.getElementById("seccionProtecciones");
      const secCond = document.getElementById("seccionConductores");

      const btnProt = document.getElementById("btnProtecciones");
      const btnCond = document.getElementById("btnConductores");

      secProt.style.display = "none";
      secCond.style.display = "none";
      btnProt.classList.remove("activo");
      btnCond.classList.remove("activo");

      if (seccion === "protecciones") {
        secProt.style.display = "block";
        btnProt.classList.add("activo");
      } else {
        secCond.style.display = "block";
        btnCond.classList.add("activo");
      }
    }

    /* ===== SECCI√ìN PROTECCIONES ===== */

    function hpToKw() {
      const hp = parseFloat(document.getElementById("potenciaHp").value);
      if (!isNaN(hp)) {
        document.getElementById("potenciaKw").value = (hp * HP_TO_KW).toFixed(2);
      }
    }

    function kwToHp() {
      const kw = parseFloat(document.getElementById("potenciaKw").value);
      if (!isNaN(kw)) {
        document.getElementById("potenciaHp").value = (kw / HP_TO_KW).toFixed(2);
      }
    }

    function calcularProtecciones() {
      const potenciaKw = parseFloat(document.getElementById("potenciaKw").value);
      const voltaje = parseFloat(document.getElementById("voltaje").value);
      const eficiencia = parseFloat(document.getElementById("eficiencia").value);
      const fp = parseFloat(document.getElementById("fp").value);
      const arranque = document.getElementById("arranque").value;

      if (isNaN(potenciaKw) || isNaN(voltaje) || isNaN(eficiencia) || isNaN(fp)) {
        alert("Por favor, ingresa todos los valores correctamente.");
        return;
      }

      const In = (potenciaKw * 1000) / (Math.sqrt(3) * voltaje * fp * eficiencia);
      let intensidadOperacion = In;

      if (arranque === "0.7") intensidadOperacion *= 0.7;
      else if (arranque === "estrella") intensidadOperacion *= 0.58;

      const contactorMin = (intensidadOperacion * 1.15).toFixed(1);
      const contactorMax = (intensidadOperacion * 1.25).toFixed(1);
      const releMin = (intensidadOperacion * 1.05).toFixed(1);
      const releMax = (intensidadOperacion * 1.15).toFixed(1);
      const itmMin = Math.ceil(In * 1.25);
      const itmMax = Math.ceil(In * 1.5);

      let resultadoHTML = `
        <strong>‚öô Resultados para motor de ${potenciaKw.toFixed(2)} kW (${(potenciaKw / HP_TO_KW).toFixed(2)} HP) a ${voltaje} V</strong><br>
        <strong>Corriente estimada (In):</strong> ${In.toFixed(2)} A
      `;

      if (arranque === "vfd") {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM">
            <div><strong>ITM:</strong> ${itmMin} A - ${itmMax} A
              <div class="etiqueta-itm">üìò Calculado al 125%-150% de In (IEC 60947-2 y criterio t√≠pico CNE Per√∫ para motores).</div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/diferencial.png" alt="Interruptor diferencial">
            <div><strong>Interruptor diferencial:</strong> Igual o superior a ${itmMin} A</div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor">
            <div><strong>Contactor:</strong> ${contactorMin} A - ${contactorMax} A <span class="opcional">(opcional)</span>
              <div class="etiqueta-itm">üìò 115%-125% de In para maniobra en AC-3 (basado en IEC 60947-4-1 y pr√°ctica industrial).</div>
            </div>
          </div>
        `;
      } else if (arranque === "estrella") {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM" />
            <div><strong>ITM:</strong> ${itmMin} A - ${itmMax} A
              <div class="etiqueta-itm">üìò Calculado al 125%-150% de In (IEC 60947-2 y criterio t√≠pico CNE Per√∫ para motores).</div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor" />
            <div><strong>Contactor:</strong><br>
              Principal y Tri√°ngulo (Œî): ${contactorMin} A - ${contactorMax} A<br>
              Estrella (Y): ${(In * 0.33 * 1.15).toFixed(1)} A - ${(In * 0.33 * 1.25).toFixed(1)} A<br>
              <span class="etiqueta-itm">üìò En estrella la corriente ‚âà33% de In; factores 115%-125% sobre esa corriente (IEC 60947-4-1, AC-3).</span>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/rele.png" alt="Rel√© t√©rmico" />
            <div><strong>Rel√© t√©rmico:</strong> ${releMin} A - ${releMax} A
              <div class="etiqueta-itm">üìò Ajuste entre 105%-115% de In para proteger al motor sin disparos molestos (criterio t√≠pico de rel√© t√©rmico).</div>
            </div>
          </div>
        `;
      } else {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM" />
            <div><strong>ITM:</strong> ${itmMin} A - ${itmMax} A
              <div class="etiqueta-itm">üìò Calculado al 125%-150% de In (IEC 60947-2 y criterio t√≠pico CNE Per√∫ para motores).</div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor" />
            <div><strong>Contactor:</strong> ${contactorMin} A - ${contactorMax} A
              <div class="etiqueta-itm">üìò 115%-125% de la corriente de servicio para maniobra en AC-3 (IEC 60947-4-1, pr√°ctica industrial).</div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/rele.png" alt="Rel√© t√©rmico" />
            <div><strong>Rel√© t√©rmico:</strong> ${releMin} A - ${releMax} A
              <div class="etiqueta-itm">üìò Ajustado cerca de In (105%-115%) para proteger el motor frente a sobrecargas prolongadas.</div>
            </div>
          </div>
        `;
      }

      resultadoHTML += `
        <div class="proteccion">
          <img src="imagenes/motor.png" alt="Motor" />
          <div><strong>Motor:</strong> ${potenciaKw.toFixed(2)} kW (${(potenciaKw / HP_TO_KW).toFixed(2)} HP), In: ${In.toFixed(2)} A</div>
        </div>

        <hr>
        <button type="button" class="modo-btn info-btn" onclick="togglePanelProtecciones()" id="btnInfoProtecciones">
          üìò ¬øDe d√≥nde salen estos valores?
        </button>
        <div id="infoCalculoProtecciones" class="info-calculo" style="display:none;">
          <strong>1. Corriente nominal del motor (In)</strong><br>
          In = P(kW) √ó 1000 / (‚àö3 ¬∑ V ¬∑ Œ∑ ¬∑ cos œÜ)<br><br>

          <strong>2. Criterio para el ITM</strong><br>
          ‚Ä¢ 125%-150% de In (IEC 60947-2 y criterios t√≠picos CNE motores).<br><br>

          <strong>3. Criterio para el contactor</strong><br>
          ‚Ä¢ 115%-125% de la corriente de servicio (IEC 60947-4-1, AC-3).<br><br>

          <strong>4. Criterio para el rel√© t√©rmico</strong><br>
          ‚Ä¢ 105%-115% de In para sobrecarga prolongada sin disparos molestos.<br><br>

          <em>Nota:</em> Valores orientativos; verificar siempre con hojas t√©cnicas y normas locales vigentes.
        </div>
      `;

      document.getElementById("resultadoProtecciones").innerHTML = resultadoHTML;
      document.getElementById("resultadoProtecciones").style.display = "block";
    }

    function togglePanelProtecciones() {
      const info = document.getElementById("infoCalculoProtecciones");
      const btn = document.getElementById("btnInfoProtecciones");
      if (!info || !btn) return;

      if (info.style.display === "block") {
        info.style.display = "none";
        btn.classList.remove("activo-info");
      } else {
        info.style.display = "block";
        btn.classList.add("activo-info");
      }
    }

    /* ===== SECCI√ìN CONDUCTORES ===== */

    // Resistividad aproximada en Œ©¬∑mm¬≤/m
    const RHO_CU = 0.018;  // Cobre
    const RHO_AL = 0.029;  // Aluminio

    // Secciones comerciales en mm¬≤ (IEC/CNE) y ampacidad aproximada Cu
    const seccionesMM = [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70];
    const ampacidadCuMM = {
      1.5: 15,
      2.5: 21,
      4: 28,
      6: 36,
      10: 50,
      16: 68,
      25: 89,
      35: 110,
      50: 140,
      70: 175
    };

    // AWG comerciales y su √°rea aproximada en mm¬≤
    const awgTable = [
      { awg: "14",  mm2: 2.08 },
      { awg: "12",  mm2: 3.31 },
      { awg: "10",  mm2: 5.26 },
      { awg: "8",   mm2: 8.37 },
      { awg: "6",   mm2: 13.30 },
      { awg: "4",   mm2: 21.10 },
      { awg: "3",   mm2: 26.70 },
      { awg: "2",   mm2: 33.60 },
      { awg: "1",   mm2: 42.40 },
      { awg: "1/0", mm2: 53.50 },
      { awg: "2/0", mm2: 67.40 },
      { awg: "3/0", mm2: 85.00 },
      { awg: "4/0", mm2: 107.00 }
    ];

    function findAWGforMm2(mm2) {
      let mejor = null;
      let mejorDiff = Infinity;
      for (const item of awgTable) {
        const diff = Math.abs(item.mm2 - mm2);
        if (diff < mejorDiff) {
          mejorDiff = diff;
          mejor = item;
        }
      }
      return mejor ? mejor.awg : "‚Äî";
    }

    function actualizarFactorPorCarga() {
      const tipo = document.getElementById("tipoCarga").value;
      const factorSelect = document.getElementById("factorDiseno");
      if (!factorSelect) return;

      if (tipo === "motor") {
        factorSelect.value = "1.25";     // Motores ‚Äì criterio tipo NEC 430.22
      } else if (tipo === "iluminacion") {
        factorSelect.value = "1.00";     // Iluminaci√≥n usual sin sobrecarga
      } else if (tipo === "tomas") {
        factorSelect.value = "1.15";     // Tomas / uso general
      } else {
        factorSelect.value = "1.20";     // Valor intermedio t√≠pico
      }
    }

    function mostrarPanelConductor(panel) {
      const infoCalc = document.getElementById("infoConductor");
      const infoAWG = document.getElementById("infoEquivalenciaAWG");
      const btnCalc = document.getElementById("btnInfoConductor");
      const btnAWG = document.getElementById("btnEquivAWG");
      if (!infoCalc || !infoAWG || !btnCalc || !btnAWG) return;

      if (panel === "calculo") {
        if (infoCalc.style.display === "block") {
          infoCalc.style.display = "none";
          btnCalc.classList.remove("activo-info");
        } else {
          infoCalc.style.display = "block";
          infoAWG.style.display = "none";
          btnCalc.classList.add("activo-info");
          btnAWG.classList.remove("activo-info");
        }
      } else if (panel === "awg") {
        if (infoAWG.style.display === "block") {
          infoAWG.style.display = "none";
          btnAWG.classList.remove("activo-info");
        } else {
          infoAWG.style.display = "block";
          infoCalc.style.display = "none";
          btnAWG.classList.add("activo-info");
          btnCalc.classList.remove("activo-info");
        }
      }
    }

    function calcularConductor() {
      const sistema = document.getElementById("sistemaConductor").value; // 1f o 3f
      const tipoCarga = document.getElementById("tipoCarga").value;
      const In = parseFloat(document.getElementById("corrienteCond").value); // corriente nominal ingresada
      const factor = parseFloat(document.getElementById("factorDiseno").value);
      const voltaje = parseFloat(document.getElementById("voltajeCond").value);
      const longitud = parseFloat(document.getElementById("longitud").value);
      const material = document.getElementById("material").value;
      const caidaMax = parseFloat(document.getElementById("caidaMax").value);

      if (isNaN(In) || isNaN(voltaje) || isNaN(longitud) || isNaN(caidaMax) || isNaN(factor)) {
        alert("Por favor, ingresa corriente, factor, tensi√≥n, longitud y % de ca√≠da de tensi√≥n.");
        return;
      }

      const Id = In * factor; // Corriente de dise√±o para el cable
      const rho = (material === "cu") ? RHO_CU : RHO_AL;
      const resultadoDiv = document.getElementById("resultadoConductor");

      let seccionSeleccionadaMM = null;
      let caidaSeleccionada = null;

      const detalles = [];

      for (let s of seccionesMM) {
        let dV;
        if (sistema === "3f") {
          dV = Math.sqrt(3) * Id * rho * longitud / s;
        } else {
          dV = 2 * Id * rho * longitud / s;
        }
        const dVporc = dV / voltaje * 100;

        let Imax;
        if (material === "cu") {
          Imax = ampacidadCuMM[s];
        } else {
          Imax = ampacidadCuMM[s] ? ampacidadCuMM[s] * 0.8 : null;
        }

        detalles.push({ s, dVporc, Imax });

        if (Imax && Id <= Imax && dVporc <= caidaMax && seccionSeleccionadaMM === null) {
          seccionSeleccionadaMM = s;
          caidaSeleccionada = dVporc;
        }
      }

      if (seccionSeleccionadaMM === null) {
        seccionSeleccionadaMM = seccionesMM[seccionesMM.length - 1];

        const det = detalles.find(d => d.s === seccionSeleccionadaMM);
        if (det) {
          caidaSeleccionada = det.dVporc;
        } else {
          let dVfinal;
          if (sistema === "3f") {
            dVfinal = Math.sqrt(3) * Id * rho * longitud / seccionSeleccionadaMM;
          } else {
            dVfinal = 2 * Id * rho * longitud / seccionSeleccionadaMM;
          }
          caidaSeleccionada = dVfinal / voltaje * 100;
        }
      }

      const awgEquiv = findAWGforMm2(seccionSeleccionadaMM);
      const textoMaterial = (material === "cu") ? "Cobre" : "Aluminio";
      const textoSistema = (sistema === "3f") ? "Trif√°sico" : "Monof√°sico";

      let textoCarga = "";
      if (tipoCarga === "motor") textoCarga = "Motor trif√°sico";
      else if (tipoCarga === "iluminacion") textoCarga = "Iluminaci√≥n";
      else if (tipoCarga === "tomas") textoCarga = "Tomas / uso general";
      else textoCarga = "Otra carga / personalizado";

      const detalleCalculosHtml = detalles.map(det => {
        const clase = det.s === seccionSeleccionadaMM ? ' class="recomendado"' : '';
        return `<li${clase}>${det.s} mm¬≤ ‚Üí ca√≠da ‚âà ${det.dVporc.toFixed(2)}% | Imax ‚âà ${det.Imax ? det.Imax.toFixed(1) : "n/d"} A</li>`;
      }).join("");

      let html = `
        <strong>üîå C√°lculo de calibre de conductor</strong><br>
        <strong>Sistema:</strong> ${textoSistema} &nbsp; | &nbsp;
        <strong>Tensi√≥n:</strong> ${voltaje} V<br>
        <strong>Tipo de carga:</strong> ${textoCarga}<br>
        <strong>Corriente nominal ingresada (In):</strong> ${In.toFixed(2)} A<br>
        <strong>Factor de dise√±o aplicado:</strong> In √ó ${factor.toFixed(2)}<br>
        <strong>Corriente de dise√±o del cable (Id):</strong> ${Id.toFixed(2)} A<br>
        <strong>Longitud del circuito (ida):</strong> ${longitud.toFixed(1)} m<br>
        <strong>Material:</strong> ${textoMaterial}<br>
        <strong>Ca√≠da de tensi√≥n m√°xima permitida:</strong> ${caidaMax.toFixed(2)} %<br><br>

        <strong>‚úÖ Secci√≥n recomendada:</strong> ${seccionSeleccionadaMM} mm¬≤ (${textoMaterial})<br>
        <strong>Equivalente comercial aproximado en AWG:</strong> ${awgEquiv} AWG<br>
        <strong>Ca√≠da de tensi√≥n estimada con esta secci√≥n (usando Id):</strong> ${caidaSeleccionada.toFixed(2)} %<br><br>

        <em>La selecci√≥n se hace buscando la primera secci√≥n comercial que cumple con la corriente de dise√±o Id (In √ó factor):</em><br>
        ‚Ä¢ Id ‚â§ Imax (capacidad de corriente aproximada seg√∫n tablas t√≠picas IEC/CNE).<br>
        ‚Ä¢ Ca√≠da de tensi√≥n ‚â§ ${caidaMax.toFixed(2)} %. <br><br>

        <strong>Detalle de evaluaci√≥n por secci√≥n (mm¬≤):</strong>
        <ul>${detalleCalculosHtml}</ul>

        <hr>
        <button type="button" class="modo-btn info-btn" id="btnInfoConductor" onclick="mostrarPanelConductor('calculo')">
          üìò ¬øDe d√≥nde sale este c√°lculo?
        </button>
        <button type="button" class="modo-btn info-btn" id="btnEquivAWG" onclick="mostrarPanelConductor('awg')">
          üîÅ Equivalencia en AWG
        </button>

        <div id="infoConductor" class="info-calculo" style="display:none;">
          <strong>1. Corriente nominal vs. corriente de dise√±o</strong><br>
          ‚Ä¢ In: corriente nominal del circuito (por ejemplo, motor).<br>
          ‚Ä¢ Id: In √ó factor de dise√±o (1.00, 1.15, 1.20, 1.25, etc.).<br>
          ‚Ä¢ Para motores, un criterio t√≠pico es usar 1.25 (125% de In, similar al criterio NEC 430.22).<br><br>

          <strong>2. F√≥rmula de ca√≠da de tensi√≥n (ŒîV) usando Id</strong><br>
          <u>Trif√°sico:</u> ŒîV ‚âà ‚àö3 ¬∑ Id ¬∑ œÅ ¬∑ L / S<br>
          <u>Monof√°sico:</u> ŒîV ‚âà 2 ¬∑ Id ¬∑ œÅ ¬∑ L / S<br><br>

          Donde:<br>
          ‚Ä¢ Id: corriente de dise√±o del cable (A).<br>
          ‚Ä¢ œÅ: resistividad del material (Œ©¬∑mm¬≤/m). Cobre ‚âà 0.018, Aluminio ‚âà 0.029.<br>
          ‚Ä¢ L: longitud del circuito (m). En monof√°sico se considera ida y retorno (por eso el 2).<br>
          ‚Ä¢ S: secci√≥n del conductor (mm¬≤).<br>
          ‚Ä¢ ŒîV% = (ŒîV / V) √ó 100.<br><br>

          <strong>3. Criterio de selecci√≥n</strong><br>
          ‚Ä¢ Se recorre una lista de secciones comerciales (1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70 mm¬≤).<br>
          ‚Ä¢ Para cada secci√≥n se calcula la ca√≠da de tensi√≥n usando Id (In √ó factor de dise√±o).<br>
          ‚Ä¢ Se exige que Id ‚â§ Imax (tabla aproximada) y que la ca√≠da de tensi√≥n ‚â§ % m√°ximo que ingresaste.<br><br>

          <strong>4. Normativa de referencia</strong><br>
          ‚Ä¢ Criterios basados en IEC y CNE (ca√≠da de tensi√≥n recomendada 3% para alimentadores de motor y 5% m√°ximo total).<br>
          ‚Ä¢ Para motores, muchos dise√±os adoptan 125% de la corriente de motor, similar al criterio NEC 430.22.<br><br>

          <em>Importante:</em> Verifica siempre con las tablas oficiales del fabricante, factores de temperatura, agrupamiento y la norma vigente antes de definir el cable en un proyecto real.
        </div>

        <div id="infoEquivalenciaAWG" class="info-calculo" style="display:none;">
          <strong>Equivalencias aproximadas AWG ‚Üî mm¬≤</strong><br>
          <p style="font-size:0.85em;">
            Tabla de calibres comerciales AWG (americano) y su √°rea aproximada en mm¬≤.
            √ötil para comparar con cables importados o documentaci√≥n en AWG.
          </p>
          <table>
            <thead>
              <tr>
                <th>AWG</th>
                <th>mm¬≤ aprox.</th>
              </tr>
            </thead>
            <tbody>
              ${awgTable.map(item => `
                <tr>
                  <td>${item.awg}</td>
                  <td>${item.mm2.toFixed(2)}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
          <p style="font-size:0.8em; margin-top:8px;">
            El calibre recomendado para este c√°lculo fue: <strong>${seccionSeleccionadaMM} mm¬≤ ‚âà ${awgEquiv} AWG</strong> (equivalencia aproximada).<br>
            Para dise√±o definitiva, revisa siempre las tablas del fabricante y la norma aplicable (NEC, IEC, CNE, etc.).
          </p>
        </div>
      `;

      resultadoDiv.innerHTML = html;
      resultadoDiv.style.display = "block";
    }

    // Ajustar factor cuando carga la p√°gina (motor por defecto)
    window.addEventListener("load", actualizarFactorPorCarga);
  </script>
</body>
</html>
